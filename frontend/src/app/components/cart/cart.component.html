<div class="cart">
  <div class="page-header">
    <h1>–ö–æ—Ä–∑–∏–Ω–∞</h1>
  </div>

  <div *ngIf="cartItems.length === 0" class="empty-cart">
    <div class="empty-cart-icon">üõí</div>
    <h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h2>
    <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑</p>
    <button class="primary-btn" (click)="continueShopping()">
      –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º
    </button>
  </div>

  <div *ngIf="cartItems.length > 0" class="cart-content">
    <div class="cart-items-section">
      <div class="cart-header">
        <h2>–¢–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ ({{ getTotalItems() }})</h2>
        <button class="clear-cart-btn" (click)="clearCart()">
          –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
        </button>
      </div>

      <div class="cart-items">
        <div *ngFor="let item of cartItems" class="cart-item">
          <div class="item-content">
            <img [src]="item.product.image_url"
                 [alt]="item.product.name"
                 class="item-image"
                 (error)="item.product.image_url = 'https://images.unsplash.com/photo-1547887535-2c0d234b5c1a?w=400&h=400&fit=crop'">

            <div class="item-details">
              <h3 class="item-name">{{ item.product.name }}</h3>
              <p class="item-brand">{{ item.product.brand }}</p>
              <p class="item-volume">{{ item.product.volume_ml }} –º–ª</p>
              <p class="item-price">{{ item.product.price | number }} ‚ÇΩ</p>
            </div>

            <div class="item-controls">
              <div class="quantity-controls">
                <button class="quantity-btn"
                        (click)="updateQuantity(item.product.id, item.quantity - 1)"
                        [disabled]="item.quantity <= 1">-</button>
                <span class="quantity">{{ item.quantity }}</span>
                <button class="quantity-btn"
                        (click)="updateQuantity(item.product.id, item.quantity + 1)">+</button>
              </div>

              <div class="item-total">
                {{ (item.product.price * item.quantity) | number }} ‚ÇΩ
              </div>

              <button class="remove-btn"
                      (click)="removeItem(item.product.id)">
                –£–¥–∞–ª–∏—Ç—å
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="cart-summary">
        <h3>–ò—Ç–æ–≥–æ: {{ getTotalPrice() | number }} ‚ÇΩ</h3>
      </div>
    </div>

    <div class="order-form-section">
      <div class="order-form-card">
        <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
        <div *ngIf="currentUser" class="user-info">
          <p><strong>Email:</strong> {{ currentUser.email }}</p>
        </div>

        <form [formGroup]="orderForm" class="order-form">
          <div class="form-group">
            <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
            <input type="tel" formControlName="customerPhone" class="form-input"
                   [class.error]="customerPhone?.invalid && customerPhone?.touched"
                   placeholder="+79991234567">
            <div class="error" *ngIf="customerPhone?.invalid && customerPhone?.touched">
              <span *ngIf="customerPhone?.hasError('required')">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</span>
              <span *ngIf="customerPhone?.hasError('pattern')">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (10-11 —Ü–∏—Ñ—Ä)</span>
            </div>
          </div>

          <div class="form-group">
            <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ *</label>
            <textarea formControlName="shippingAddress"
                      class="form-input textarea"
                      [class.error]="shippingAddress?.invalid && shippingAddress?.touched"
                      rows="3"
                      placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞..."></textarea>
            <div class="error" *ngIf="shippingAddress?.invalid && shippingAddress?.touched">
              <span *ngIf="shippingAddress?.hasError('required')">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</span>
              <span *ngIf="shippingAddress?.hasError('minlength')">–ú–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤</span>
            </div>
          </div>
        </form>

        <div *ngIf="!isAuthenticated" class="auth-warning">
          ‚ö†Ô∏è –î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
        </div>

        <button class="order-btn primary-btn"
                (click)="createOrder()"
                [disabled]="orderForm.invalid || !isAuthenticated">
          –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
        </button>
      </div>
    </div>
  </div>
</div>
